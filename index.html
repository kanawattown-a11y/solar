<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>المنظومة الشمسية الواقعية (النسخة النهائية المصححة)</title>
    <style>
        body { margin: 0; background-color: #000; overflow: hidden; }
        canvas { display: block; }
        .label {
            color: #fff;
            font-family: 'Arial', sans-serif;
            padding: 5px 10px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 5px;
            font-size: 16px;
            text-shadow: 0 0 8px #000;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.164.1/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.164.1/examples/jsm/"
            }
        }
    </script>
    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import { CSS2DRenderer, CSS2DObject } from 'three/addons/renderers/CSS2DRenderer.js';
        import { EffectComposer } from 'three/addons/postprocessing/EffectComposer.js';
        import { RenderPass } from 'three/addons/postprocessing/RenderPass.js';
        import { UnrealBloomPass } from 'three/addons/postprocessing/UnrealBloomPass.js';

        // --- إعدادات أساسية ---
        const scene = new THREE.Scene( );
        const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 10000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.toneMapping = THREE.ACESFilmicToneMapping;
        renderer.toneMappingExposure = 0.6;
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.PCFSoftShadowMap;
        document.body.appendChild(renderer.domElement);

        const labelRenderer = new CSS2DRenderer();
        labelRenderer.setSize(window.innerWidth, window.innerHeight);
        labelRenderer.domElement.style.position = 'absolute';
        labelRenderer.domElement.style.top = '0px';
        document.body.appendChild(labelRenderer.domElement);

        const controls = new OrbitControls(camera, labelRenderer.domElement);
        controls.enableDamping = true;
        controls.minDistance = 30;
        controls.maxDistance = 2500;

        // --- التحميلات والخلفية ---
        const textureLoader = new THREE.TextureLoader();
        const cubeTextureLoader = new THREE.CubeTextureLoader();
        // ** تم استخدام الأسماء التي حددتها أنت **
        const cubeMap = cubeTextureLoader.setPath('./').load([
            'right.jpg', // Right
            'left.jpg',  // Left
            'top.jpg',   // Top
            'bottom.jpg',// Bottom
            'front.jpg', // Front
            'back.jpg'   // Back
        ]);
        scene.background = cubeMap;

        // --- الشمس والإضاءة ---
        const sun = new THREE.Mesh(
            new THREE.SphereGeometry(25, 64, 64),
            new THREE.MeshBasicMaterial({ map: textureLoader.load('./8k_sun.jpg') })
        );
        scene.add(sun);

        const pointLight = new THREE.PointLight(0xffffff, 200000);
        pointLight.castShadow = true;
        pointLight.shadow.mapSize.width = 2048;
        pointLight.shadow.mapSize.height = 2048;
        scene.add(pointLight);
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.05);
        scene.add(ambientLight);

        // --- تأثير التوهج (Bloom) ---
        const composer = new EffectComposer(renderer);
        composer.addPass(new RenderPass(scene, camera));
        const bloomPass = new UnrealBloomPass(new THREE.Vector2(window.innerWidth, window.innerHeight), 2.0, 0.5, 0.0);
        composer.addPass(bloomPass);

        // --- دالة إنشاء الكواكب المحسّنة ---
        function createPlanet({ name, size, textureUrl, position, ring, normalMap, specularMap, clouds }) {
            const planet = new THREE.Mesh(
                new THREE.SphereGeometry(size, 64, 64),
                new THREE.MeshStandardMaterial({
                    map: textureLoader.load(textureUrl),
                    normalMap: normalMap ? textureLoader.load(normalMap) : null,
                    specularMap: specularMap ? textureLoader.load(specularMap) : null,
                    metalness: 0.2,
                    roughness: 0.7
                })
            );
            planet.receiveShadow = true;
            planet.castShadow = true;
            
            const planetObj = new THREE.Object3D();
            planetObj.add(planet);
            planet.position.x = position;
            scene.add(planetObj);

            if (name === 'الأرض') {
                const atmosphere = new THREE.Mesh(
                    new THREE.SphereGeometry(size + 0.2, 64, 64),
                    new THREE.ShaderMaterial({
                        vertexShader: `varying vec3 vNormal; void main() { vNormal = normalize(normalMatrix * normal); gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0); }`,
                        fragmentShader: `varying vec3 vNormal; void main() { float intensity = pow(0.6 - dot(vNormal, vec3(0.0, 0.0, 1.0)), 2.0); gl_FragColor = vec4(0.3, 0.6, 1.0, 1.0) * intensity; }`,
                        blending: THREE.AdditiveBlending, side: THREE.BackSide
                    })
                );
                planet.add(atmosphere);
            }

            let cloudsMesh;
            if (clouds) {
                cloudsMesh = new THREE.Mesh(
                    new THREE.SphereGeometry(size + 0.08, 64, 64),
                    new THREE.MeshStandardMaterial({ map: textureLoader.load(clouds.textureUrl), transparent: true, opacity: 0.4 })
                );
                planet.add(cloudsMesh);
            }

            if (ring) {
                const ringMesh = new THREE.Mesh(
                    new THREE.RingGeometry(ring.innerRadius, ring.outerRadius, 128),
                    new THREE.MeshStandardMaterial({ map: textureLoader.load(ring.textureUrl), side: THREE.DoubleSide, transparent: true, opacity: 0.9 })
                );
                ringMesh.receiveShadow = true;
                planet.add(ringMesh);
                ringMesh.rotation.x = -0.5 * Math.PI;
            }
            
            const orbit = new THREE.Mesh(
                new THREE.RingGeometry(position - 0.2, position + 0.2, 256),
                new THREE.MeshBasicMaterial({ color: 0xffffff, side: THREE.DoubleSide, transparent: true, opacity: 0.15 })
            );
            orbit.rotation.x = -0.5 * Math.PI;
            scene.add(orbit);
            
            const div = document.createElement('div');
            div.className = 'label';
            div.textContent = name;
            const label = new CSS2DObject(div);
            label.position.set(0, size + 4, 0);
            planet.add(label);

            return { mesh: planet, obj: planetObj, clouds: cloudsMesh };
        }
        
        // --- حزام الكويكبات ---
        const asteroidBelt = new THREE.Object3D();
        const asteroidGeometry = new THREE.DodecahedronGeometry(Math.random() * 0.5, 0);
        const asteroidMaterial = new THREE.MeshStandardMaterial({ color: 0x888888, roughness: 1 });
        for (let i = 0; i < 5000; i++) {
            const angle = Math.random() * Math.PI * 2;
            const distance = 450 + Math.random() * 150;
            const x = Math.cos(angle) * distance;
            const z = Math.sin(angle) * distance;
            const y = (Math.random() - 0.5) * 20;
            const asteroid = new THREE.Mesh(asteroidGeometry, asteroidMaterial);
            asteroid.position.set(x, y, z);
            asteroid.rotation.set(Math.random(), Math.random(), Math.random());
            asteroidBelt.add(asteroid);
        }
        scene.add(asteroidBelt);

        // --- بيانات الكواكب بالمقياس المحسّن (بدون قمر) ---
        const planetsData = [
            { name: 'عطارد', size: 2.4, textureUrl: './8k_mercury.jpg', position: 80 },
            { name: 'الزهرة', size: 6.0, textureUrl: './8k_venus_surface.jpg', position: 150 },
            { name: 'الأرض', size: 6.3, textureUrl: './8k_earth_daymap.jpg', position: 220,
                normalMap: './earth_normal.jpg', specularMap: './earth_specular.jpg',
                clouds: { textureUrl: './earth_clouds.png' } },
            { name: 'المريخ', size: 3.4, textureUrl: './8k_mars.jpg', position: 320 },
            { name: 'المشتري', size: 18, textureUrl: './8k_jupiter.jpg', position: 700 },
            { name: 'زحل', size: 15, textureUrl: './8k_saturn.jpg', position: 1100,
                ring: { innerRadius: 18, outerRadius: 35, textureUrl: './8k_saturn_ring_alpha.png' } },
            { name: 'أورانوس', size: 10, textureUrl: './2k_uranus.jpg', position: 1600,
                ring: { innerRadius: 12, outerRadius: 20, textureUrl: './2k_uranus_ring_alpha.png' } },
            { name: 'نبتون', size: 9.8, textureUrl: './2k_neptune.jpg', position: 2000 }
        ];

        const planets = planetsData.map(p => createPlanet(p));

        // --- الإعدادات النهائية والتحريك ---
        camera.position.set(0, 200, 550);
        camera.lookAt(scene.position);

        const clock = new THREE.Clock();
        function animate() {
            requestAnimationFrame(animate);
            const delta = clock.getDelta();

            sun.rotation.y += 0.001;
            asteroidBelt.rotation.y += 0.0001;
            
            const selfRotationSpeeds = [0.1, 0.05, 0.5, 0.4, 1.2, 1.1, 0.8, 0.7];
            const orbitSpeeds = [0.1, 0.08, 0.06, 0.05, 0.02, 0.01, 0.005, 0.003];
            
            planets.forEach((p, i) => {
                p.mesh.rotation.y += selfRotationSpeeds[i] * delta;
                p.obj.rotation.y += orbitSpeeds[i] * delta;
                if (p.clouds) p.clouds.rotation.y += 0.6 * delta;
            });

            controls.update();
            composer.render();
            labelRenderer.render(scene, camera);
        }

        animate();

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
            composer.setSize(window.innerWidth, window.innerHeight);
            labelRenderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
